2025-09-20 01:37:41.074 [ERROR] Application error MB-RTU配置不存在
Error: MB-RTU配置不存在
    at DeviceData.getMBRTUConfig (/Users/xujing/Workspace/cloned-website/backend/src/models/deviceData.js:602:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async /Users/xujing/Workspace/cloned-website/backend/src/controllers/deviceController.js:359:20
{
  "service": "iot-backend",
  "version": "1.0.0",
  "url": "/api/mb-rtu-config/dtu/DTU_1755937662576_iw32nv",
  "method": "GET",
  "ip": "::1",
  "userAgent": "curl/8.7.1",
  "requestId": "07e0e866-f731-40da-a291-4877333b131b",
  "query": {},
  "params": {}
}
2025-09-20 01:37:56.401 [ERROR] Application error MB-RTU配置不存在
Error: MB-RTU配置不存在
    at DeviceData.getMBRTUConfig (/Users/xujing/Workspace/cloned-website/backend/src/models/deviceData.js:602:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async /Users/xujing/Workspace/cloned-website/backend/src/controllers/deviceController.js:359:20
{
  "service": "iot-backend",
  "version": "1.0.0",
  "url": "/api/mb-rtu-config/dtu/DTU_1755937662576_iw32nv",
  "method": "GET",
  "ip": "::1",
  "userAgent": "curl/8.7.1",
  "requestId": "7096716c-e48c-4926-8402-84294293d70a",
  "query": {},
  "params": {}
}
2025-09-20 01:38:04.587 [ERROR] Application error MB-RTU配置不存在
Error: MB-RTU配置不存在
    at DeviceData.getMBRTUConfig (/Users/xujing/Workspace/cloned-website/backend/src/models/deviceData.js:602:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async /Users/xujing/Workspace/cloned-website/backend/src/controllers/deviceController.js:359:20
{
  "service": "iot-backend",
  "version": "1.0.0",
  "url": "/api/mb-rtu-config/dtu/DTU_1755937662576_iw32nv",
  "method": "GET",
  "ip": "::1",
  "userAgent": "curl/8.7.1",
  "requestId": "d62289da-64e0-405a-a69c-29479027e2f7",
  "query": {},
  "params": {}
}
2025-09-20 01:40:15.831 [ERROR] Application error 传感器不存在或不属于该DTU设备
Error: 传感器不存在或不属于该DTU设备
    at DeviceData.updateMBRTUConfig (/Users/xujing/Workspace/cloned-website/backend/src/models/deviceData.js:498:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async /Users/xujing/Workspace/cloned-website/backend/src/controllers/deviceController.js:330:20
{
  "service": "iot-backend",
  "version": "1.0.0",
  "url": "/api/mb-rtu-config/DTU_1755937662576_iw32nv/NONEXISTENT_SENSOR",
  "method": "PUT",
  "ip": "::1",
  "userAgent": "curl/8.7.1",
  "requestId": "9302574f-3861-49c0-bfb8-ece9cca3297a",
  "body": {
    "function_code": "03读写"
  },
  "query": {},
  "params": {}
}
2025-09-20 01:42:30.799 [ERROR] Application error 路径 /api/mb-rtu-config/DTU_1755937662576_iw32nv 不存在
Error: 路径 /api/mb-rtu-config/DTU_1755937662576_iw32nv 不存在
    at notFoundHandler (/Users/xujing/Workspace/cloned-website/backend/src/middleware/errorHandler.js:136:17)
    at Layer.handleRequest (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/lib/layer.js:152:17)
    at trimPrefix (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:342:13)
    at /Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:297:9
    at processParams (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:582:12)
    at next (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:291:5)
    at /Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:688:15
    at next (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:276:14)
    at Function.handle (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:186:3)
    at router (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:60:12)
{
  "service": "iot-backend",
  "version": "1.0.0",
  "url": "/api/mb-rtu-config/DTU_1755937662576_iw32nv",
  "method": "GET",
  "ip": "::1",
  "userAgent": "curl/8.7.1",
  "requestId": "3b49e6cd-7f4d-4bf7-aded-1364a033a101",
  "query": {},
  "params": {}
}
2025-09-20 01:42:42.407 [ERROR] Application error 路径 /api/mb-rtu-config/DTU_1755937662576_iw32nv 不存在
Error: 路径 /api/mb-rtu-config/DTU_1755937662576_iw32nv 不存在
    at notFoundHandler (/Users/xujing/Workspace/cloned-website/backend/src/middleware/errorHandler.js:136:17)
    at Layer.handleRequest (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/lib/layer.js:152:17)
    at trimPrefix (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:342:13)
    at /Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:297:9
    at processParams (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:582:12)
    at next (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:291:5)
    at /Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:688:15
    at next (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:276:14)
    at Function.handle (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:186:3)
    at router (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:60:12)
{
  "service": "iot-backend",
  "version": "1.0.0",
  "url": "/api/mb-rtu-config/DTU_1755937662576_iw32nv",
  "method": "GET",
  "ip": "::1",
  "userAgent": "curl/8.7.1",
  "requestId": "eae00ba9-68c1-4f86-97ed-77d9a9f31122",
  "query": {},
  "params": {}
}
2025-09-20 01:50:17.553 [ERROR] Application error 路径 /api/groups/1 不存在
Error: 路径 /api/groups/1 不存在
    at notFoundHandler (/Users/xujing/Workspace/cloned-website/backend/src/middleware/errorHandler.js:136:17)
    at Layer.handleRequest (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/lib/layer.js:152:17)
    at trimPrefix (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:342:13)
    at /Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:297:9
    at processParams (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:582:12)
    at next (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:291:5)
    at /Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:688:15
    at next (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:276:14)
    at Function.handle (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:186:3)
    at router (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:60:12)
{
  "service": "iot-backend",
  "version": "1.0.0",
  "url": "/api/groups/1",
  "method": "GET",
  "ip": "::1",
  "userAgent": "curl/8.7.1",
  "requestId": "d8e11178-efd6-444e-b431-d02622519e38",
  "query": {},
  "params": {}
}
2025-09-20 01:50:23.083 [ERROR] Application error 分组不存在或为默认分组，无法修改
Error: 分组不存在或为默认分组，无法修改
    at DeviceData.updateGroup (/Users/xujing/Workspace/cloned-website/backend/src/models/deviceData.js:349:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async /Users/xujing/Workspace/cloned-website/backend/src/controllers/deviceController.js:464:20
{
  "service": "iot-backend",
  "version": "1.0.0",
  "url": "/api/groups/24",
  "method": "PUT",
  "ip": "::1",
  "userAgent": "curl/8.7.1",
  "requestId": "090977bc-9931-49c7-9283-7b0d1834f705",
  "body": {
    "group_name": "默认分组",
    "description": "测试更新"
  },
  "query": {},
  "params": {}
}
2025-09-20 02:28:59.377 [ERROR] Application error req.validationErrors is not a function
TypeError: req.validationErrors is not a function
    at handleValidationErrors (/Users/xujing/Workspace/cloned-website/backend/src/middleware/groupValidation.js:7:22)
    at Layer.handleRequest (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/lib/layer.js:152:17)
    at next (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/lib/route.js:157:13)
    at middleware (/Users/xujing/Workspace/cloned-website/backend/node_modules/express-validator/lib/middlewares/check.js:16:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
{
  "service": "iot-backend",
  "version": "1.0.0",
  "url": "/api/groups",
  "method": "POST",
  "ip": "::1",
  "userAgent": "curl/8.7.1",
  "requestId": "c820dc62-0e28-4467-b043-a48ce856285b",
  "body": {
    "group_name": "测试分组API",
    "description": "测试新的分组API"
  },
  "query": {},
  "params": {}
}
2025-09-20 02:44:24.373 [ERROR] Query error recorded
{
  "service": "iot-backend",
  "version": "1.0.0",
  "error": "Cannot add or update a child row: a foreign key constraint fails (`dam_monitoring_system`.`mb_rtu_config`, CONSTRAINT `mb_rtu_config_ibfk_1` FOREIGN KEY (`dtu_id`) REFERENCES `dtu_devices` (`device_id`) ON DELETE CASCADE)",
  "code": "ER_NO_REFERENCED_ROW_2",
  "query": "INSERT INTO mb_rtu_config (\n        dtu_id, sensor_id, slave_address, function_code, offset_value, \n        data_format, data_bits, byte_order_value, collection_cycle\n      ) VALUES (?, ?, ?, ?, ?, ?,"
}
2025-09-20 02:44:38.399 [ERROR] Query error recorded
{
  "service": "iot-backend",
  "version": "1.0.0",
  "error": "Duplicate entry 'TEST_DEVICE_001-SENSOR_001' for key 'mb_rtu_config.dtu_id'",
  "code": "ER_DUP_ENTRY",
  "query": "INSERT INTO mb_rtu_config (\n        dtu_id, sensor_id, slave_address, function_code, offset_value, \n        data_format, data_bits, byte_order_value, collection_cycle\n      ) VALUES (?, ?, ?, ?, ?, ?,"
}
2025-09-20 16:51:20.878 [ERROR] Query error recorded
{
  "service": "iot-backend",
  "version": "1.0.0",
  "error": "Cannot add or update a child row: a foreign key constraint fails (`dam_monitoring_system`.`mb_rtu_config`, CONSTRAINT `mb_rtu_config_ibfk_2` FOREIGN KEY (`sensor_id`) REFERENCES `sensors` (`sensor_id`) ON DELETE CASCADE)",
  "code": "ER_NO_REFERENCED_ROW_2",
  "query": "INSERT INTO mb_rtu_config (\n        dtu_id, sensor_id, slave_address, function_code, offset_value, \n        data_format, data_bits, byte_order_value, collection_cycle\n      ) VALUES (?, ?, ?, ?, ?, ?,"
}
2025-09-20 17:01:39.520 [ERROR] Application error 路径 /api/mb-rtu-config/TEST_DEVICE_001 不存在
Error: 路径 /api/mb-rtu-config/TEST_DEVICE_001 不存在
    at notFoundHandler (/Users/xujing/Workspace/cloned-website/backend/src/middleware/errorHandler.js:136:17)
    at Layer.handleRequest (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/lib/layer.js:152:17)
    at trimPrefix (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:342:13)
    at /Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:297:9
    at processParams (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:582:12)
    at next (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:291:5)
    at /Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:688:15
    at next (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:276:14)
    at Function.handle (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:186:3)
    at router (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:60:12)
{
  "service": "iot-backend",
  "version": "1.0.0",
  "url": "/api/mb-rtu-config/TEST_DEVICE_001",
  "method": "GET",
  "ip": "::1",
  "userAgent": "curl/8.7.1",
  "requestId": "8a70c2b5-a932-438d-b779-b2c3b12131a4",
  "query": {},
  "params": {}
}
2025-09-20 17:06:23.441 [ERROR] Application error 路径 /api/mb-rtu/TEST_DEVICE_001/SENSOR_001 不存在
Error: 路径 /api/mb-rtu/TEST_DEVICE_001/SENSOR_001 不存在
    at notFoundHandler (/Users/xujing/Workspace/cloned-website/backend/src/middleware/errorHandler.js:136:17)
    at Layer.handleRequest (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/lib/layer.js:152:17)
    at trimPrefix (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:342:13)
    at /Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:297:9
    at processParams (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:582:12)
    at next (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:291:5)
    at /Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:688:15
    at next (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:276:14)
    at Function.handle (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:186:3)
    at router (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:60:12)
{
  "service": "iot-backend",
  "version": "1.0.0",
  "url": "/api/mb-rtu/TEST_DEVICE_001/SENSOR_001",
  "method": "DELETE",
  "ip": "::1",
  "userAgent": "curl/8.7.1",
  "requestId": "2136df5e-c268-45e2-8092-b0d42a9eab49",
  "query": {},
  "params": {}
}
2025-09-20 17:06:46.429 [ERROR] Application error MB-RTU协议不存在
Error: MB-RTU协议不存在
    at MbRtuData.deleteMBRTU (/Users/xujing/Workspace/cloned-website/backend/src/models/mbRtuData.js:198:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async /Users/xujing/Workspace/cloned-website/backend/src/controllers/mbRtuController.js:81:20
{
  "service": "iot-backend",
  "version": "1.0.0",
  "url": "/api/mb-rtu/TEST_DEVICE_001/SENSOR_001",
  "method": "DELETE",
  "ip": "::1",
  "userAgent": "curl/8.7.1",
  "requestId": "eb75beaf-6502-4ba5-a8d4-c366f77b9ae6",
  "query": {},
  "params": {}
}
2025-09-20 17:12:03.463 [ERROR] Application error 路径 /api/mb-rtu 不存在
Error: 路径 /api/mb-rtu 不存在
    at notFoundHandler (/Users/xujing/Workspace/cloned-website/backend/src/middleware/errorHandler.js:136:17)
    at Layer.handleRequest (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/lib/layer.js:152:17)
    at trimPrefix (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:342:13)
    at /Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:297:9
    at processParams (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:582:12)
    at next (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:291:5)
    at /Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:688:15
    at next (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:276:14)
    at Function.handle (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:186:3)
    at router (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:60:12)
{
  "service": "iot-backend",
  "version": "1.0.0",
  "url": "/api/mb-rtu",
  "method": "POST",
  "ip": "::1",
  "userAgent": "curl/8.7.1",
  "requestId": "dd3fd09b-ca06-46bf-bc40-51e9f2c6be0b",
  "body": {
    "dtu_id": "TEST_DEVICE_001",
    "sensor_id": "SENSOR_001",
    "slave_address": 1,
    "function_code": "04只读",
    "offset_value": 0,
    "data_format": "16位有符号数",
    "collection_cycle": 2
  },
  "query": {},
  "params": {}
}
2025-09-20 17:12:22.229 [ERROR] Application error 路径 /api/mb-rtu 不存在
Error: 路径 /api/mb-rtu 不存在
    at notFoundHandler (/Users/xujing/Workspace/cloned-website/backend/src/middleware/errorHandler.js:136:17)
    at Layer.handleRequest (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/lib/layer.js:152:17)
    at trimPrefix (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:342:13)
    at /Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:297:9
    at processParams (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:582:12)
    at next (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:291:5)
    at /Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:688:15
    at next (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:276:14)
    at Function.handle (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:186:3)
    at router (/Users/xujing/Workspace/cloned-website/backend/node_modules/router/index.js:60:12)
{
  "service": "iot-backend",
  "version": "1.0.0",
  "url": "/api/mb-rtu",
  "method": "POST",
  "ip": "::1",
  "userAgent": "curl/8.7.1",
  "requestId": "3cf05c51-427a-4d24-8f7a-06a25f11e570",
  "body": {
    "dtu_id": "TEST_DEVICE_001",
    "sensor_id": "SENSOR_001",
    "slave_address": 1,
    "function_code": "04只读",
    "offset_value": 0,
    "data_format": "16位有符号数",
    "collection_cycle": 2
  },
  "query": {},
  "params": {}
}
2025-09-20 17:12:35.775 [ERROR] Query error recorded
{
  "service": "iot-backend",
  "version": "1.0.0",
  "error": "Table 'dam_monitoring_system.mb_rtu' doesn't exist",
  "code": "ER_NO_SUCH_TABLE",
  "query": "INSERT INTO mb_rtu (\n        dtu_id, sensor_id, slave_address, function_code, offset_value, \n        data_format, data_bits, byte_order_value, collection_cycle\n      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, "
}
