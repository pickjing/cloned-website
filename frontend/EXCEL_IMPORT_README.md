# Excel导入功能使用说明

## 功能概述

新建设备页面现在支持通过Excel文件批量导入传感器数据，无需手动逐个添加传感器。

## 使用方法

### 1. 准备Excel文件

Excel文件需要包含以下列（表头）：

| 列名 | 说明 | 是否必需 | 示例 |
|------|------|----------|------|
| **名称** | 传感器名称 | ✅ 必需 | 温度传感器1 |
| **类型** | 传感器类型 | ✅ 必需 | 数值型 |
| **小数位** | 小数位数 | ✅ 必需 | 1 |
| **单位** | 测量单位 | ✅ 必需 | °C |
| **排序** | 排序号 | ❌ 可选 | 1 |
| **上行映射** | 上行映射配置 | ❌ 可选 | field1=-32768,field2=32767,field3=-2048,field4=2047.9 |
| **下行映射** | 下行映射配置 | ❌ 可选 | field1=0,field2=100,field3=0,field4=100 |

### 2. 映射格式说明

#### 上行映射和下行映射格式
```
field1=值1,field2=值2,field3=值3,field4=值4
```

其中：
- `field1` → `x1` (映射下限)
- `field2` → `y1` (映射上限)  
- `field3` → `x2` (实际值下限)
- `field4` → `y2` (实际值上限)

#### 示例
```
field1=-32768,field2=32767,field3=-2048,field4=2047.9
```

### 3. 导入步骤

1. 在新建设备页面，找到"传感器管理"部分
2. 点击"导入Excel"按钮
3. 选择准备好的Excel文件
4. 系统自动验证文件格式和内容
5. 导入成功后，传感器数据会显示在传感器列表中

### 4. 数据验证规则

- **文件格式**：必须是.xlsx或.xls格式
- **表头验证**：必须包含所有必需字段
- **数据验证**：名称、类型、小数位、单位不能为空
- **无效行处理**：不符合要求的行会被自动跳过

### 5. 自动补全功能

- **传感器ID**：系统自动生成唯一ID
- **排序号**：如果Excel中排序为空，系统自动从现有最大排序号+1开始递增
- **图标**：使用默认图标路径 `/image/传感器图片.png`

## 示例Excel文件

### 完整示例数据

| 名称 | 类型 | 小数位 | 单位 | 排序 | 上行映射 | 下行映射 |
|------|------|--------|------|------|----------|----------|
| 温度传感器1 | 数值型 | 1 | °C | 1 | field1=-32768,field2=32767,field3=-2048,field4=2047.9 | field1=0,field2=100,field3=0,field4=100 |
| 湿度传感器1 | 数值型 | 1 | %RH | 2 | field1=-32768,field2=32767,field3=-2048,field4=2047.9 | field1=0,field2=100,field3=0,field4=100 |
| 压力传感器1 | 数值型 | 2 | kPa | 3 | field1=-32768,field2=32767,field3=-2048,field4=2047.9 | field1=0,field2=1000,field3=0,field4=1000 |

## 注意事项

1. **文件大小**：建议Excel文件不超过10MB
2. **数据格式**：确保数值字段为数字格式
3. **编码问题**：建议使用UTF-8编码保存Excel文件
4. **备份数据**：导入前建议备份现有传感器数据

## 错误处理

### 常见错误及解决方案

| 错误类型 | 原因 | 解决方案 |
|----------|------|----------|
| 文件格式错误 | 选择了非Excel文件 | 选择.xlsx或.xls格式文件 |
| 表头缺失 | Excel缺少必需字段 | 检查表头是否包含所有必需列 |
| 数据为空 | 关键字段为空值 | 填写名称、类型、小数位、单位 |
| 映射格式错误 | 映射字符串格式不正确 | 按照field1=值1,field2=值2格式填写 |

## 技术实现

- **前端处理**：使用SheetJS (xlsx) 库解析Excel文件
- **数据验证**：实时验证文件格式和内容
- **错误处理**：友好的错误提示和日志记录
- **性能优化**：支持大文件处理，逐行解析

## 测试

可以使用 `test_excel_import.html` 文件测试Excel导入功能：

1. 在浏览器中打开测试页面
2. 下载Excel模板
3. 选择模板文件进行导入测试
4. 查看解析结果

---

如有问题，请检查浏览器控制台的错误日志。
